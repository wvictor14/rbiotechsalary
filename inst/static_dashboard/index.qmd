---
title: "r/biotechsalary"
format:
  dashboard:
    nav-buttons:
      - icon: github
        href: https://github.com/wvictor14/rbiotechsalary
        aria-label: GitHub
      - icon: house-fill
        href: https://wvictor14.github.io/
        aria-label: Homepage
    scrolling: false
    embed-resources: false
    theme: 
      - cosmo
editor: source
editor_options: 
  chunk_output_type: console
---


```{r setup_r}
#| echo: false
#| include: false
library(quarto)
library(here)
library(dplyr)
library(tidyr)
library(purrr)
library(forcats)
library(stringr)
library(ggplot2)
library(scales)
library(reactable)
library(gt)
library(gtExtras)
library(devtools)
source(here::here('R', 'rb_clean_data.R'))
```

```{r data_prep}
#| echo: false
#| include: false


# load data for app
salaries_file <- here::here(
  'inst', 'extdata', 'salary_results_cleaned.csv'
)

if (!file.exists(salaries_file)) {
  message('Processed data not detected. Running processing script...')
  quarto::quarto_render(here::here('inst', 'extdata', 'clean_data.qmd'))
}

salaries <- readr::read_csv(salaries_file, show_col_types = FALSE) |> 
  rb_clean_data()
message('Processed data loaded')

# links
link_add_data <- shiny::tags$a(
  bsicons::bs_icon("plus-lg"), " Add Your Salary",
  href = "https://docs.google.com/forms/d/e/1FAIpQLSeXpPvkjdf8EPRU_cAdyMAUFVjgx67nyVgDxV7TNHeFkR2k9A/viewform",
  target = "_blank"
)
link_github <- shiny::tags$a(
  shiny::icon("github"), " Source",
  href = "https://github.com/wvictor14/rbiotechsalary",
  target = "_blank"
)
link_reddit <- shiny::tags$a(
  bsicons::bs_icon("reddit"), " Reddit",
  href = "https://www.reddit.com/r/biotech/comments/125cy06/rbiotech_salary_and_company_survey/",
  target = "_blank"
)
link_google <- shiny::tags$a(
  bsicons::bs_icon("file-earmark-spreadsheet"), " Raw Data",
  href = "https://docs.google.com/spreadsheets/d/1G0FmJhkOME_sv66hWmhnZS5qR2KMTY7nzkxksv46bfk/edit#gid=491268892",
  target = "_blank"
)

# colors
.colors <- list(
  'primary' = '#41AB5DFF'
)

version <- paste0('v', as.character(utils::packageVersion('rbiotechsalary')))

# pass to ojs
ojs_define(salaries_ojs = salaries)
```


# Salaries 

## {.sidebar}

```{ojs}
//| output: false
job_titles_general = [...new Set(transpose(salaries_ojs).map(d => d.title_general))].sort()
location_country = [...new Set(transpose(salaries_ojs).map(d => d.location_country))].sort()
```

```{ojs}
viewof salary_min = Inputs.range(
  [0, 950000], 
  {value: 0, step: 5000, label: "Salary (min):"}
)

viewof select_job_title_general = Inputs.select(
  job_titles_general, 
  {label:"Job Title", value: 'Scientist'}
)

viewof select_location_country = Inputs.select(
  location_country, 
  {label:"Country", value: 'United States Of America'}
)
```

## column

```{ojs}
filtered = transpose(salaries_ojs).filter(function(x) {
  return salary_min < x.salary_total &&
         select_job_title_general.includes(x.title_general) &&
         select_location_country.includes(x.location_country)
         ;
})

Plot.plot({
  y: {grid: true},
  marks: [
    Plot.rectY(filtered, Plot.binX({y: "count"}, {x: "salary_total"})),
    Plot.ruleY([0])
  ]
})
```